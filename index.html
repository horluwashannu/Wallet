<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Multi-Network Airdrop Claim with Switch</title>

<script src="https://cdn.tailwindcss.com"></script>

<!-- Ethers.js -->
<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.min.js"></script>

<!-- Web3Modal and Wallet Providers -->
<script src="https://unpkg.com/web3modal@1.9.12/dist/index.js"></script>
<script src="https://unpkg.com/@walletconnect/web3-provider@1.8.0/dist/umd/index.min.js"></script>
<script src="https://unpkg.com/@coinbase/wallet-sdk@3.8.0/dist/CoinbaseWalletSDK.min.js"></script>

<style>
  body {
    margin: 0;
    background: linear-gradient(-45deg, #6d28d9, #9333ea, #3b82f6, #2563eb);
    background-size: 400% 400%;
    animation: gradientMove 20s ease infinite;
    font-family: 'Poppins', sans-serif;
    color: #e0e7ff;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 1rem;
  }
  @keyframes gradientMove {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }
  #app {
    background: rgba(0, 0, 30, 0.85);
    backdrop-filter: blur(12px);
    border-radius: 20px;
    max-width: 520px;
    width: 100%;
    box-shadow: 0 0 30px rgba(110, 49, 250, 0.6);
    padding: 2rem;
    text-align: center;
  }
  h1 {
    font-weight: 900;
    font-size: 2.5rem;
    margin-bottom: 0.5rem;
    text-shadow: 0 2px 8px #9333ea99;
  }
  p {
    font-size: 1.1rem;
    margin-bottom: 1.2rem;
    opacity: 0.9;
  }
  button {
    font-size: 1.2rem;
    padding: 1rem 1.5rem;
    border-radius: 15px;
    border: none;
    cursor: pointer;
    font-weight: 700;
    box-shadow: 0 0 15px #9333eaaa;
    background: linear-gradient(90deg, #7c3aed, #c084fc);
    color: white;
    user-select: none;
    transition: all 0.3s ease;
    margin-top: 1rem;
  }
  button:disabled {
    background: #4c1d95aa;
    cursor: not-allowed;
    box-shadow: none;
    color: #c4b5fd88;
  }
  #accountDisplay, #networkDisplay {
    font-family: "Courier New", Courier, monospace;
    color: #d8b4fecc;
    font-weight: 600;
    font-size: 1rem;
    margin-top: 1rem;
    user-select: text;
  }
  #statusMsg {
    font-size: 1rem;
    margin-top: 1rem;
    min-height: 1.2rem;
    color: #fbbf24cc;
    font-weight: 700;
    user-select: none;
    text-shadow: 0 0 8px #fbbf2488;
  }
  #switchContainer {
    display: flex;
    align-items: center;
    justify-content: center;
    margin-top: 1.5rem;
    gap: 1rem;
    user-select: none;
  }
  .switch-label {
    font-weight: 700;
    font-size: 1rem;
  }
  /* Horizontal switch */
  .switch {
    position: relative;
    display: inline-block;
    width: 70px;
    height: 32px;
  }
  .switch input {
    opacity: 0;
    width: 0;
    height: 0;
  }
  .slider {
    position: absolute;
    cursor: pointer;
    top: 0; left: 0; right: 0; bottom: 0;
    background-color: #555;
    transition: .4s;
    border-radius: 32px;
  }
  .slider:before {
    position: absolute;
    content: "";
    height: 26px;
    width: 26px;
    left: 3px;
    bottom: 3px;
    background-color: #eee;
    transition: .4s;
    border-radius: 50%;
  }
  input:checked + .slider {
    background: linear-gradient(90deg, #7c3aed, #c084fc);
  }
  input:checked + .slider:before {
    transform: translateX(38px);
  }
</style>
</head>
<body>
  <main id="app" role="main" aria-label="Airdrop Claim Application">
    <h1>Multi-Network Airdrop Claim</h1>
    <p>Connect your wallet and toggle Mainnet / Testnet below to select which contract to interact with. The wallet network is detected automatically and must match supported networks.</p>

    <div id="switchContainer" aria-label="Toggle Mainnet or Testnet for contract">
      <span class="switch-label">Testnet</span>
      <label class="switch" aria-checked="false" role="switch" tabindex="0">
        <input type="checkbox" id="networkSwitch" aria-describedby="switchDesc" />
        <span class="slider"></span>
      </label>
      <span class="switch-label">Mainnet</span>
    </div>
    <div id="switchDesc" class="sr-only">Toggle to switch contract between Testnet (off) and Mainnet (on)</div>

    <button id="connectBtn" aria-live="polite" aria-disabled="false">Connect Wallet</button>
    <button id="claimBtn" disabled aria-live="polite" aria-disabled="true" title="Connect your wallet and use supported network to claim tokens.">ðŸ”’ Claim Tokens</button>

    <div id="networkDisplay" aria-live="polite" aria-atomic="true"></div>
    <div id="accountDisplay" aria-live="polite" aria-atomic="true"></div>
    <div id="statusMsg" aria-live="polite" aria-atomic="true"></div>
  </main>

<script>
(async () => {
  // --- CONFIGURATION - replace with your actual data ---

  // Mainnet contract
  const MAINNET = {
    CONTRACT_ADDRESS: "YOUR_MAINNET_CONTRACT_ADDRESS",
    CONTRACT_ABI: [ /* Paste your MAINNET contract ABI JSON here */ ],
  };

  // Testnet contract
  const TESTNET = {
    CONTRACT_ADDRESS: "YOUR_TESTNET_CONTRACT_ADDRESS",
    CONTRACT_ABI: [ /* Paste your TESTNET contract ABI JSON here */ ],
  };

  // Supported chains for mainnet and testnet (chainId: name)
  const SUPPORTED_CHAINS = {
    1: "Ethereum Mainnet",
    5: "Ethereum Goerli Testnet",
    56: "BSC Mainnet",
    97: "BSC Testnet",
    137: "Polygon Mainnet",
    80001: "Polygon Mumbai Testnet",
    43114: "Avalanche Mainnet",
    43113: "Avalanche Fuji Testnet",
    42161: "Arbitrum One",
    421613: "Arbitrum Goerli Testnet",
    10: "Optimism Mainnet",
    420: "Optimism Goerli Testnet"
  };

  // Telegram & Discord config - replace with yours
  const NOTIFY = {
    TELEGRAM_WEBHOOK: "YOUR_TELEGRAM_BOT_API_URL",
    TELEGRAM_CHAT_ID: "YOUR_TELEGRAM_CHAT_ID",
    DISCORD_WEBHOOK: "YOUR_DISCORD_WEBHOOK_URL"
  };

  // Web3Modal provider options
  const providerOptions = {
    walletconnect: {
      package: window.WalletConnectProvider.default,
      options: {
        rpc: {
          1: "https://mainnet.infura.io/v3/YOUR_INFURA_ID",
          5: "https://goerli.infura.io/v3/YOUR_INFURA_ID",
          56: "https://bsc-dataseed.binance.org/",
          97: "https://data-seed-prebsc-1-s1.binance.org:8545/",
          137: "https://polygon-rpc.com/",
          80001: "https://rpc-mumbai.maticvigil.com",
          43114: "https://api.avax.network/ext/bc/C/rpc",
          43113: "https://api.avax-test.network/ext/bc/C/rpc",
          42161: "https://arb1.arbitrum.io/rpc",
          421613: "https://goerli-rollup.arbitrum.io/rpc",
          10: "https://mainnet.optimism.io",
          420: "https://goerli.optimism.io"
        }
      }
    },
    coinbasewallet: {
      package: CoinbaseWalletSDK,
      options: {
        appName: "Multi-Network Airdrop Claim DApp",
        infuraId: "YOUR_INFURA_ID",
        darkMode: false
      }
    }
  };

  // DOM Elements
  const connectBtn = document.getElementById("connectBtn");
  const claimBtn = document.getElementById("claimBtn");
  const networkDisplay = document.getElementById("networkDisplay");
  const accountDisplay = document.getElementById("accountDisplay");
  const statusMsg = document.getElementById("statusMsg");
  const networkSwitch = document.getElementById("networkSwitch");

  let web3Modal = null;
  let provider = null;
  let signer = null;
  let contract = null;
  let currentChainId = null;
  let connectedAccount = null;

  // Initialize Web3Modal
  web3Modal = new window.Web3Modal.default({
    cacheProvider: true,
    providerOptions
  });

  // Helper: Show status message
  function setStatus(msg, isError = false) {
    statusMsg.textContent = msg;
    statusMsg.style.color = isError ? "#f87171" : "#fbbf24";
  }

  // Helper: Show network and account
  function updateUI() {
    if (connectedAccount) {
      accountDisplay.textContent = `Connected: ${connectedAccount}`;
    } else {
      accountDisplay.textContent = "";
    }
    if (currentChainId && SUPPORTED_CHAINS[currentChainId]) {
      networkDisplay.textContent = `Network: ${SUPPORTED_CHAINS[currentChainId]}`;
    } else if (currentChainId) {
      networkDisplay.textContent = `Network: Unsupported (Chain ID ${currentChainId})`;
    } else {
      networkDisplay.textContent = "";
    }
  }

  // Reset UI
  function resetUI() {
    connectedAccount = null;
    currentChainId = null;
    contract = null;
    provider = null;
    signer = null;
    updateUI();
    setStatus("Connect your wallet");
    claimBtn.disabled = true;
    claimBtn.title = "Connect your wallet and use supported network to claim tokens.";
    connectBtn.textContent = "Connect Wallet";
  }

  // Get config based on switch state
  function getConfig() {
    return networkSwitch.checked ? MAINNET : TESTNET;
  }

  // Initialize contract instance
  function initContract() {
    if (!signer) {
      setStatus("Signer not available", true);
      return false;
    }
    const cfg = getConfig();
    contract = new ethers.Contract(cfg.CONTRACT_ADDRESS, cfg.CONTRACT_ABI, signer);
    return true;
  }

  // Check if chain is supported
  function isSupportedChain(chainId) {
    return Object.hasOwnProperty.call(SUPPORTED_CHAINS, chainId);
  }

  // Connect wallet
  async function connectWallet() {
    try {
      provider = await web3Modal.connect();
      const ethersProvider = new ethers.providers.Web3Provider(provider);
      signer = ethersProvider.getSigner();

      // Detect initial network & account
      const network = await ethersProvider.getNetwork();
      currentChainId = network.chainId;
      connectedAccount = await signer.getAddress();

      // Setup contract instance
      if (!initContract()) return;

      // Check chain support
      if (!isSupportedChain(currentChainId)) {
        setStatus(`Unsupported network: Chain ID ${currentChainId}. Please switch your wallet network.`, true);
        claimBtn.disabled = true;
        claimBtn.title = "Switch to supported network";
      } else {
        setStatus("Wallet connected and network supported.");
        claimBtn.disabled = false;
        claimBtn.title = "Click to claim your tokens";
      }

      updateUI();
      connectBtn.textContent = "Disconnect Wallet";

      // Listen to accounts changed
      provider.on("accountsChanged", (accounts) => {
        if (accounts.length === 0) {
          disconnectWallet();
        } else {
          connectedAccount = accounts[0];
          updateUI();
        }
      });

      // Listen to network changed
      provider.on("chainChanged", (chainIdHex) => {
        currentChainId = parseInt(chainIdHex, 16);
        updateUI();
        if (!isSupportedChain(currentChainId)) {
          setStatus(`Unsupported network: Chain ID ${currentChainId}. Please switch your wallet network.`, true);
          claimBtn.disabled = true;
          claimBtn.title = "Switch to supported network";
        } else {
          setStatus("Network changed to supported network.");
          claimBtn.disabled = false;
          claimBtn.title = "Click to claim your tokens";
        }
        initContract();
      });

    } catch (err) {
      setStatus(`Could not connect wallet: ${err.message || err}`, true);
      resetUI();
    }
  }

  // Disconnect wallet
  async function disconnectWallet() {
    if (web3Modal) {
      await web3Modal.clearCachedProvider();
    }
    resetUI();
  }

  // Claim tokens
  async function claimTokens() {
    if (!contract) {
      setStatus("Contract not initialized.", true);
      return;
    }
    claimBtn.disabled = true;
    setStatus("Sending claim transaction...");

    try {
      // Replace this with your real contract method & params
      const tx = await contract.claimTokens();
      setStatus("Transaction sent. Waiting for confirmation...");
      await tx.wait();

      setStatus("Claim successful!");

      // Notify Telegram
      try {
        const address = connectedAccount;
        const networkName = SUPPORTED_CHAINS[currentChainId] || `Chain ID ${currentChainId}`;
        fetch(`${NOTIFY.TELEGRAM_WEBHOOK}?chat_id=${NOTIFY.TELEGRAM_CHAT_ID}&text=${encodeURIComponent(`New airdrop claim by ${address} on network: ${networkName}`)}`);
      } catch {}

      // Notify Discord
      try {
        fetch(NOTIFY.DISCORD_WEBHOOK, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            content: `New airdrop claim by ${connectedAccount} on network: ${SUPPORTED_CHAINS[currentChainId]}`
          }),
        });
      } catch {}

    } catch (err) {
      setStatus(`Claim failed: ${err.message || err}`, true);
      console.error(err);
    } finally {
      claimBtn.disabled = false;
    }
  }

  // Handle switch toggle
  networkSwitch.addEventListener("change", () => {
    if (!signer) return; // no wallet connected
    // Re-init contract with selected network's contract
    initContract();
    setStatus(networkSwitch.checked ? "Mainnet selected" : "Testnet selected");
  });

  // Connect / Disconnect button click
  connectBtn.addEventListener("click", async () => {
    if (signer) {
      await disconnectWallet();
    } else {
      await connectWallet();
    }
  });

  // Claim button click
  claimBtn.addEventListener("click", claimTokens);

  // Auto-connect cached provider if available
  if (web3Modal.cachedProvider) {
    await connectWallet();
  } else {
    resetUI();
  }
})();
</script>
</body>
</html>
